<!DOCTYPE html>
<html lang="ja" class="no-js"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="alternate" type="application/rss+xml" title="" href="https://initto.devprotocol.xyz/feed.xml"><link rel="icon" href="https://devprotocol.xyz/favicon.png" type="image/png"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"><title>Deep Dive Khaos - INITTO</title><link rel="canonical" href="https://initto.devprotocol.xyz/ja/deep-dive-khaos/"><meta property="og:site_name" content="INITTO"><meta property="og:title" content="Deep Dive Khaos - INITTO"><meta property="og:type" content="website"><meta property="og:url" content="https://initto.devprotocol.xyz/ja/deep-dive-khaos/"><meta name="twitter:creator" content="@devprtcl"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://initto.devprotocol.xyz/images/posts/deep-dive-khaos/ogp.png"><meta name="twitter:image" content="https://initto.devprotocol.xyz/images/posts/deep-dive-khaos/ogp.png"><meta property="og:image:alt" content="Page image for INITTO"><meta name="twitter:image:alt" content="Page image for INITTO"><meta name="google-site-verification" content="nIP9puHEliBioOqsX2IYmNqzxQE9g_qgB5HepqZskNY"><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-189612836-1"></script><script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-189612836-1');</script><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><script>document.documentElement.classList.remove('no-js');</script><style>*{box-sizing:border-box}:after,:before{box-sizing:inherit}body,dd,dl,dt,figcaption,figure,h1,h2,h3,h4,li,ol,p,ul{margin:0;padding:0}body{-ms-overflow-style:-ms-autohiding-scrollbar;scroll-behavior:smooth;font-size:1rem;min-height:100vh}ol[class],ul[class]{list-style:none}a:not([class]){text-decoration:underline;text-decoration-skip-ink:auto;cursor:pointer}input::-webkit-input-placeholder,select::-webkit-input-placeholder,textarea::-webkit-input-placeholder{line-height:normal}img{max-width:100%}@media(prefers-reduced-motion:reduce){*{-webkit-animation:none!important;animation:none!important;transition:none!important;scroll-behavior:auto!important}}.sf-flow{--flow-space:1em}.sf-flow>*+*{margin-top:1em;margin-top:var(--flow-space)}.align-start{align-items:flex-start}.align-center{align-items:center}.align-end{align-items:flex-end}.bg-primary{background:#173854}.bg-primary-shade{background:#102538}.bg-primary-glare{background:#22547c}.bg-highlight{background:#fedb8b}.bg-light{background:#fff}.bg-mid{background:#ccc}.bg-dark{background:#0a0a0a}.bg-text{background:#373d3f}.bg-slate{background:#404040}.color-primary{color:#173854}.color-primary-shade{color:#102538}.color-primary-glare{color:#22547c}.color-highlight{color:#fedb8b}.color-light{color:#fff}.color-mid{color:#ccc}.color-dark{color:#0a0a0a}.color-text{color:#373d3f}.color-slate{color:#404040}.box-block{display:block}.box-flex{display:flex}.box-inline-flex{display:inline-flex}.box-hide{display:none}.font-base{font-family:Whyte,'Helvetica Neue',Arial,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif}.font-serif{font-family:Whyte,'Times New Roman',YuMincho,'Hiragino Mincho ProN','Yu Mincho','MS PMincho' serif}.gap-top-300{margin-top:.8rem}.gap-top-500{margin-top:1.25rem}.gap-top-600{margin-top:1.56rem}.gap-top-700{margin-top:1.95rem}.gap-top-800{margin-top:2.44rem}.gap-top-900{margin-top:3.05rem}.gap-top-base{margin-top:1rem}.gap-top-max{margin-top:4rem}.gap-top-maxover{margin-top:5rem}.gap-bottom-300{margin-bottom:.8rem}.gap-bottom-500{margin-bottom:1.25rem}.gap-bottom-600{margin-bottom:1.56rem}.gap-bottom-700{margin-bottom:1.95rem}.gap-bottom-800{margin-bottom:2.44rem}.gap-bottom-900{margin-bottom:3.05rem}.gap-bottom-base{margin-bottom:1rem}.gap-bottom-max{margin-bottom:4rem}.gap-bottom-maxover{margin-bottom:5rem}.leading-tight{line-height:1.2}.leading-mid{line-height:1.5}.leading-loose{line-height:1.7}.measure-long{max-width:75ch}.measure-short{max-width:60ch}.measure-compact{max-width:40ch}.pad-top-300{padding-top:.8rem}.pad-top-500{padding-top:1.25rem}.pad-top-600{padding-top:1.56rem}.pad-top-700{padding-top:1.95rem}.pad-top-800{padding-top:2.44rem}.pad-top-900{padding-top:3.05rem}.pad-top-base{padding-top:1rem}.pad-top-max{padding-top:4rem}.pad-top-maxover{padding-top:5rem}.pad-bottom-300{padding-bottom:.8rem}.pad-bottom-500{padding-bottom:1.25rem}.pad-bottom-600{padding-bottom:1.56rem}.pad-bottom-700{padding-bottom:1.95rem}.pad-bottom-800{padding-bottom:2.44rem}.pad-bottom-900{padding-bottom:3.05rem}.pad-bottom-base{padding-bottom:1rem}.pad-bottom-max{padding-bottom:4rem}.pad-bottom-maxover{padding-bottom:5rem}.pad-left-300{padding-left:.8rem}.pad-left-500{padding-left:1.25rem}.pad-left-600{padding-left:1.56rem}.pad-left-700{padding-left:1.95rem}.pad-left-800{padding-left:2.44rem}.pad-left-900{padding-left:3.05rem}.pad-left-base{padding-left:1rem}.pad-left-max{padding-left:4rem}.pad-left-maxover{padding-left:5rem}.space-between{justify-content:space-between}.space-around{justify-content:space-around}.space-before{justify-content:flex-end}.stack-300{z-index:0}.stack-400{z-index:10}.stack-500{z-index:20}.stack-600{z-index:30}.stack-700{z-index:40}.ta-right{text-align:right}.ta-left{text-align:left}.ta-center{text-align:center}.text-300{font-size:.8rem}.text-500{font-size:1.25rem}.text-600{font-size:1.56rem}.text-700{font-size:1.95rem}.text-800{font-size:2.44rem}.text-900{font-size:3.05rem}.text-base{font-size:1rem}.text-max{font-size:4rem}.text-maxover{font-size:5rem}.weight-light{font-weight:300}.weight-regular{font-weight:400}.weight-mid{font-weight:600}.weight-bold{font-weight:700}.width-full{width:100%}.width-half{width:50%}.width-quarter{width:25%}.width-third{width:33.3333333333%}@media screen and (min-width:48rem){.md\:align-start{align-items:flex-start}.md\:align-center{align-items:center}.md\:align-end{align-items:flex-end}.md\:box-block{display:block}.md\:box-flex{display:flex}.md\:box-inline-flex{display:inline-flex}.md\:box-hide{display:none}.md\:space-between{justify-content:space-between}.md\:space-around{justify-content:space-around}.md\:space-before{justify-content:flex-end}.md\:ta-right{text-align:right}.md\:ta-left{text-align:left}.md\:ta-center{text-align:center}.md\:text-300{font-size:.8rem}.md\:text-500{font-size:1.25rem}.md\:text-600{font-size:1.56rem}.md\:text-700{font-size:1.95rem}.md\:text-800{font-size:2.44rem}.md\:text-900{font-size:3.05rem}.md\:text-base{font-size:1rem}.md\:text-max{font-size:4rem}.md\:text-maxover{font-size:5rem}.md\:width-full{width:100%}.md\:width-half{width:50%}.md\:width-quarter{width:25%}.md\:width-third{width:33.3333333333%}}:root{--color-primary:#173854;--color-primary-shade:#102538;--color-primary-glare:#22547c;--color-highlight:#fedb8b;--color-light:#ffffff;--color-mid:#cccccc;--color-dark:#0a0a0a;--color-text:#373D3F;--color-slate:#404040;--color-mode:"light";--color-bg:#ffffff;--color-bg-glare:#ffffff;--color-text:#373D3F;--color-text-glare:#0a0a0a;--color-selection-text:#ffffff;--color-selection-bg:#0a0a0a;--color-stroke:#cccccc;--color-action-bg:#173854;--color-action-text:#ffffff;--color-theme-primary:#373D3F;--color-theme-primary-glare:#ffffff;--color-theme-highlight:#fedb8b;--color-theme-highlight-block:#fedb8b;--color-link:#2577b0}:root{--color-mode:"dark"}[data-user-color-scheme=dark]{--color-bg:#0a0a0a;--color-bg-glare:#404040;--color-text:#ffffff;--color-selection-text:#0a0a0a;--color-selection-bg:#ffffff;--color-stroke:#404040;--color-theme-primary:#8bb8df;--color-theme-primary-glare:#b3d2ea;--color-action-bg:var(--color-theme-primary-glare);--color-action-text:#0a0a0a;--color-theme-highlight:#fedb8b;--color-theme-highlight-block:#404040;--color-theme-feature-text:#fedb8b}body{color:var(--color-text);background-color:var(--color-bg)}main{overflow:hidden}::selection{color:var(--color-selection-text);background-color:var(--color-selection-bg)}@font-face{font-family:Whyte;font-style:normal;font-weight:700;font-display:swap;src:url(/fonts/Whyte/Whyte-Bold.otf) format("opentype")}@font-face{font-family:Whyte;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/Whyte/Whyte-Regular.otf) format("opentype")}@font-face{font-family:Whytelnktrap;font-style:normal;font-weight:700;font-display:swap;src:url(/fonts/WhyteInktrap/WhyteInktrap-Bold.otf) format("opentype")}@font-face{font-family:Whytelnktrap;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/WhyteInktrap/WhyteInktrap-Regular.otf) format("opentype")}body{line-height:1.56;font-family:Whyte,'Helvetica Neue',Arial,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif}h1,h2,h3{font-family:Whyte,'Times New Roman',YuMincho,'Hiragino Mincho ProN','Yu Mincho','MS PMincho' serif}h1{font-size:1.95rem}h2{font-size:1.56rem}h3{font-size:1.25rem}@media(min-width:48rem){h1{font-size:2.44rem}h2{font-size:1.95rem}h3{font-size:1.56rem}}body,html{height:100%}body{scroll-behavior:smooth;display:flex;flex-direction:column}main{flex:1 0 auto}main:focus{outline:0}hr{display:block;height:1px;max-width:500px;background:var(--color-stroke);border:none;margin:3.05rem auto}img{height:auto}.inner-wrapper{max-width:57.5rem;margin-left:auto;margin-right:auto;padding-left:1.25rem;padding-right:1.25rem}.post__footer h2 a,.skip-link:not(:focus),.visually-hidden{border:0;clip:rect(0 0 0 0);height:auto;margin:0;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap}.wrapper{max-width:58rem;margin-left:auto;margin-right:auto;padding-left:1.25rem;padding-right:1.25rem}.button{display:inline-block;border:none;background-color:var(--color-action-bg);color:var(--color-action-text);padding:.8rem 1rem;line-height:1;margin:0;text-decoration:none;cursor:pointer;-webkit-appearance:none;-moz-appearance:none}.button:focus,.button:hover{filter:brightness(1.2)}.button:focus:hover{outline:0}.button:focus:not(:hover){outline:1px solid var(--color-action-text);outline-offset:-4px}.button:active{transform:scale(.99)}form{max-width:35rem}form br{display:none}label{display:block;font-weight:600}input,select{line-height:1}input,select,textarea{background-color:#fff;font:inherit;border:1px solid var(--color-text);margin-top:.15rem;padding:.5rem 1rem;width:100%;font-family:Whyte,'Helvetica Neue',Arial,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif}label input{margin:-.25rem .5rem 0 0;width:auto;vertical-align:middle}fieldset{border:0;margin:0;padding:0}legend{display:block;font-weight:700}.field-list{margin:0;padding:0;list-style:none}.field-list__field-group{margin-bottom:2rem;transition:transform 150ms}.field-list__field-group__description{display:block;margin-top:.3rem;font-size:.875rem;line-height:1.25}textarea+.field-list__field-group__description{margin-top:0}.field-list__field-group--confirm{font-weight:400}.field-list__field-group__list{list-style:none;margin:0}.field-list__field-group__list label{font-weight:400}.field-list__field-group__list .field-list__field-group__description{margin:0 0 0 1.35rem}.heading-permalink{color:var(--color-theme-primary-glare);font-size:.8em;margin-left:.3em;margin-top:.2em}@media(min-width:48rem){.heading-permalink{font-size:.6em;margin-top:.4em}}.intro{background:var(--color-selection-bg);color:var(--color-selection-text)}.intro__summary{--flow-space:0.8rem;font-size:1.25rem}.intro__summary a{color:currentColor}.intro__summary a:hover{text-decoration:none}.intro__heading{max-width:40ex;color:var(--color-selection-text)}.intro__heading--compact{max-width:20ex}.intro__meta{display:flex;align-items:center}.intro__meta__social{margin-left:.5em}.nav__list{overflow-x:auto;padding:.5rem;margin:-.5rem;-webkit-overflow-scrolling:touch;-ms-overflow-style:none}.nav__list::-webkit-scrollbar{display:none}.nav__list>*+*{margin-left:1.25rem}.nav__item{padding:.8rem 0;flex-shrink:0}.nav__item a{color:currentColor;font-weight:600}.nav__item a:not(:hover){text-decoration:none}.tag__list{overflow-x:auto;padding:.5rem;margin:-.5rem;-webkit-overflow-scrolling:touch;-ms-overflow-style:none}.tag__list::-webkit-scrollbar{display:none}.tag__list>*+*{margin-left:1.25rem}.tag__item{padding:.8rem 0;flex-shrink:0}.tag__item a{color:currentColor;border-radius:3px;background:#f0f0f0!important;text-decoration:none;font-weight:600}.pagination{flex-wrap:wrap}.pagination a{color:var(--color-theme-primary)}.pagination a:not(:hover){text-decoration:none}.pagination a[data-direction=backwards]{flex-direction:row-reverse}.pagination a[data-direction=backwards] svg{transform:rotate(-180deg)}.pagination a[data-direction=forwards]:only-child{margin-left:auto}.pagination svg{pointer-events:none}.latest-post:before{display:table;content:" "}.latest-post:after{clear:both;display:table;content:" "}.latest-post__cover{width:66.66666667%;float:left;padding-left:12px;padding-right:15px;margin-bottom:15px}.latest-post__cover a{background-origin:border-box;background-size:contain;background-color:#f0f0f0;width:100%;height:350px;display:block}.latest-post__data{width:33.33333333%;float:left;padding-left:9px;padding-right:15px;margin-bottom:15px;display:block}.latest-post__data__link,.latest-post__data__link:visited{color:var(--color-theme-primary);text-decoration:none}.latest-post__data__link:hover{text-decoration:none}.latest-post__data__excerpt{color:rgba(0,0,0,.54);fill:rgba(0,0,0,.54)}@media(max-width:767px){.latest-post{max-width:26rem;margin:0 auto}.latest-post__cover{width:100%}.latest-post__cover a{height:175px}.latest-post__data{width:100%}}.post__body{--flow-space:1.95rem}.post__body h2+*,.post__body h3+*{--flow-space:0.8rem}.post__body h2,.post__body h3{position:relative;line-height:1.2}.post__body a:not([class]){color:var(--color-link);text-decoration:underline;position:relative;display:inline-block;padding:.2rem .4rem .3rem .4rem;word-break:break-word;line-height:1.2}.post__body a:not([class]):hover{text-decoration:underline}.post__body code{font-size:1.2em;color:var(--color-theme-primary);font-weight:600;margin-left:.01ch;margin-right:.01ch}.post__body pre>code{margin-right:0;border:1px solid rgba(255,255,255,.1);overflow-x:auto;-webkit-overflow-scrolling:touch}.post__body blockquote{border-left:.2rem solid var(--color-theme-primary);margin-left:0;padding-left:1.25rem;font-style:italic;background-color:#e9f5ee}.post__body blockquote p{opacity:.8;padding:.8rem 0}.post__body ol:not([class]),.post__body ul:not([class]){margin-left:2.44rem}.post__body ol:not([class]) li+li,.post__body ul:not([class]) li+li{margin-top:.8rem}.post__body .video-player,.post__body .video-player+*,.post__body figure,.post__body figure+*,.post__body pre>code,.post__body video{--flow-space:4rem}.post__body .video-player,.post__body figure,.post__body pre>code,.post__body video{width:100vw;max-width:58rem;margin-left:50%;transform:translateX(-50%);position:relative}.post__body .video-player,.post__body figure img,.post__body pre>code{box-shadow:0 10px 30px rgba(0,0,0,.15)}.post__body figure img{position:relative;z-index:1}.post__body figcaption{font-size:.8em;font-style:italic;max-width:57.5rem;margin:.5rem auto 0 auto;padding:0 1.25rem}.post__body pre>code{display:block;background:var(--color-action-bg);padding:.8rem;font-size:1.25rem}.post__footer h2{flex-shrink:0;margin-right:1rem;color:var(--color-dark)}.post__footer a{background:var(--color-bg);padding:.4rem .6rem}.post-list__items{display:grid;gap:2rem;grid-template-columns:repeat(auto-fit,26rem);justify-content:start;justify-items:center}.post-list__item{max-width:26rem;border:1px solid #fff;border-radius:3px;width:100%;padding:.8rem}.post-list__item:hover{border:1px solid #f0f0f0}.post-list__link,.post-list__link:visited{color:var(--color-theme-primary);text-decoration:none}.post-list__link:hover{text-decoration:underline}.post-list__cover{background-origin:border-box;background-size:cover;background-color:#f0f0f0;height:172px;display:block;margin-bottom:15px}.post-list__meta .info a{color:#737171;text-decoration:none;cursor:pointer}.post-list__meta .info .date{color:rgba(0,0,0,.54);fill:rgba(0,0,0,.54);font-size:15px}.post-list__meta .info .divider:after{content:"·"}.post-list__meta .info .reading-time:after{content:attr(title)}.post-meta{margin-top:15px}.post-meta .info a{color:#737171;text-decoration:none;cursor:pointer}.post-meta .info .date{color:rgba(0,0,0,.54);fill:rgba(0,0,0,.54);font-size:15px}.post-meta .info .divider:after{content:"·"}.post-meta .info .reading-time:after{content:attr(title)}.select{font-weight:400!important;appearance:none;border-radius:3px;background-size:20px 100%;background-image:url(/images/arrow_dropdown.svg);background-repeat:no-repeat;background-position:right .6em top 50%;padding:.3em 1.5em .3em 1em}.site-head__site-name{font-weight:700;text-decoration:none;color:var(--color-text)}.site-foot{background:var(--color-selection-bg);color:var(--color-selection-text);border-top:1px solid var(--color-stroke)}.site-foot a{color:currentColor;text-decoration:none}.site-foot a:hover{text-decoration:underline}.site-foot__credit{text-align:center}.site-foot__inner{display:flex}.site-foot__inner__item{display:grid;grid-template-columns:1fr 1fr 1fr;justify-content:space-between;width:50%}.site-foot__inner__link-item{flex:1 1 auto;flex-wrap:wrap;padding:0 1.25rem 2.44rem}.skip-link:focus{display:inline-block;position:absolute;top:0;left:0;padding:.8rem 1.25rem 1rem 1.25rem;background-color:var(--color-action-bg);color:var(--color-action-text);line-height:1;text-decoration:none;font-weight:700}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#d4d0ab}.token.punctuation{color:#fefefe}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ffa07a}.token.boolean,.token.number{color:#00e0e0}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#abe338}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#00e0e0}.token.atrule,.token.attr-value,.token.function{color:gold}.token.keyword{color:#00e0e0}.token.important,.token.regex{color:gold}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{color:windowText;background:window}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token.atrule,.token.attr-value,.token.function,.token.keyword,.token.operator,.token.selector{font-weight:700}.token.attr-value,.token.comment,.token.doctype,.token.function,.token.keyword,.token.operator,.token.property,.token.string{color:highlight}.token.attr-value,.token.url{font-weight:400}}.video-player{position:relative;padding-top:56.25%}.video-player>iframe{position:absolute;top:0;left:0;width:100%;height:100%}.post .video-player{padding-top:63%}@media(min-width:48rem){.post .video-player{padding-top:66%}}.level{display:inline-block;margin-top:.8rem;padding:0 .5rem;border:2px solid rgba(32,33,36,.16);border-radius:5px}.intro__level{display:inline-block;margin-bottom:.8rem;padding:0 .5rem;font-size:1rem;font-weight:700;border:2px solid #fff;border-radius:5px}.intro__author{color:rgba(255,255,255,.8);font-size:1.25rem}.watch{margin-top:.8rem;color:gray;font-size:.8rem}::-moz-selection,::selection{color:#fff;background-color:#5b8bf5}.intro__heading--initto{max-width:none}.site-head__site-name{font-family:Whytelnktrap}.post__body pre>code{font-size:.8rem}.post__body code{font-size:85%;background:rgba(135,131,120,.15);border-radius:3px;padding:.2em .4em}.notification{background-color:#fdf7ea;line-height:180%}@media screen and (max-width:48rem){.post-list__items{grid-template-columns:100%}.tags{display:flex;flex-direction:column;align-items:start}.tags .nav__list{display:flex;flex-direction:column;align-items:start}.tags .nav__list .tag__item{margin:0}.site-head__site-name{display:block}.site-foot__inner{flex-direction:column}.site-foot__inner .site-foot__inner__item{display:initial}.site-foot__inner .site-foot__inner__item a{display:block}.site-foot__inner .site-foot__inner__item .site-foot__inner__link-item{padding:0;padding-bottom:1rem}.site-foot__inner .site-foot__inner__item .site-foot__inner__link-item:last-child{padding-bottom:0}}table{border:1px solid #ddd;width:100%;text-align:left;font-size:.9rem;border-collapse:collapse}table td,table th{padding:5px 5px}table thead tr{background-color:#ccc}table thead tr th{text-align:center}table tfoot{border-top:1px solid #ddd}table tbody tr:nth-of-type(2n){background:#f5f5f5}</style></head><body><a class="skip-link" href="#main-content">Skip to content</a><header role="banner" class="[ site-head ] [ pad-top-700 pad-bottom-700"><div class="wrapper"><div class="[ site-head__inner ] [ md:box-flex space-between align-center ]"><a href="/ja" class="[ site-head__site-name ] [ leading-tight md:box-flex align-center ]"><span class="visually-hidden">INITTO - Home</span> <span class="[ site-head__site-name ] [ text-600 ]" aria-hidden="true">INITTO</span></a><nav class="nav" aria-label="navigation"><ul class="[ nav__list ] [ box-flex align-center md:space-before ]"><li class="nav__item"><a href="https://github.com/dev-protocol">GitHub</a></li><li class="nav__item"><a href="https://devprotocol.xyz/">About Us</a></li></ul></nav></div></div></header><main id="main-content" tabindex="-1"><article class="[ post ] [ h-entry ]"><header class="[ intro ] [ pad-top-900 pad-bottom-max ]"><div class="[ inner-wrapper ] [ sf-flow ]"><h1 class="[ intro__heading ] [ text-800 md:text-900 leading-tight ] [ p-name ]">Deep Dive Khaos</h1><div class="intro__author">Aggre</div><div class="[ intro__summary ] [ sf-flow ] [ leading-mid measure-short ]"><div class="[ intro__meta ] [ text-500 leading-tight ]"><time datetime="2021-03-20T00:00:00.000Z" class="dt-published">2021-03-20</time><div class="[ intro__meta__social ]"><a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Deep Dive Khaos - INITTO%0D%0A" data-size="large"><svg width="30px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 400 400" style="enable-background:new 0 0 400 400" xml:space="preserve"><style type="text/css">.st0{fill:#1b9df0}.st1{fill:#fff}</style><g id="Dark_Blue"><circle class="st0" cx="200" cy="200" r="200"></circle></g><g id="Logo__x2014__FIXED"><path class="st1" d="M163.4,305.5c88.7,0,137.2-73.5,137.2-137.2c0-2.1,0-4.2-0.1-6.2c9.4-6.8,17.6-15.3,24.1-25
            c-8.6,3.8-17.9,6.4-27.7,7.6c10-6,17.6-15.4,21.2-26.7c-9.3,5.5-19.6,9.5-30.6,11.7c-8.8-9.4-21.3-15.2-35.2-15.2
            c-26.6,0-48.2,21.6-48.2,48.2c0,3.8,0.4,7.5,1.3,11c-40.1-2-75.6-21.2-99.4-50.4c-4.1,7.1-6.5,15.4-6.5,24.2
            c0,16.7,8.5,31.5,21.5,40.1c-7.9-0.2-15.3-2.4-21.8-6c0,0.2,0,0.4,0,0.6c0,23.4,16.6,42.8,38.7,47.3c-4,1.1-8.3,1.7-12.7,1.7
            c-3.1,0-6.1-0.3-9.1-0.9c6.1,19.2,23.9,33.1,45,33.5c-16.5,12.9-37.3,20.6-59.9,20.6c-3.9,0-7.7-0.2-11.5-0.7
            C110.8,297.5,136.2,305.5,163.4,305.5"></path></g></svg></a></div></div></div><div class="[ pad-right-100 ]">所要時間, 12分</div><div class="intro__level">中級以上</div></div></header><div class="[ post__body ] [ inner-wrapper ] [ leading-loose pad-top-900 pad-bottom-900 text-400 ] [ sf-flow ] [ e-content ]"><h1>Khaos</h1><p>こんにちは、Aggre です。</p><p>この記事では、Dev Protocol のサイドプロジェクトとして開発されている Khaos のことを知ることができます。</p><p>Khaos とは、ブロックチェーン上に存在しない情報をブロックチェーンの外部からブロックチェーンに持ち込む "オラクル(神託)" の機能を担っています。そのため Khaos Oracle と呼ぶこともあります。</p><h1>オラクルの必要性</h1><p>Khaos に限らず、Ethereum には様々なオラクルプロトコルが存在します。Ethereum とは、スマートコントラクトによって定義されたプロトコルに基づいて発生する状態遷移の連鎖を保持した巨大なステートです。つまり入力トランザクションが存在しないデータは Ethereum 上に存在しないことになります。入力されるデータソースを HTTP から取得したい場合は、HTTP のレスポンスを手作業で入力するか、信頼できるボットによって自動的に入力させるかのどちらかとなり、オラクルとは後者のユースケースで使用されます。例えば "明日の東京の気温を当てた人が勝つブロックチェーンゲーム" を作るとき、"東京の気温データ" が必要になります。そのデータを天気マニアの Alice が手作業で入力する場合と、気象庁のデータベースから得られたデータをボットが入力するように記述されたスマートコントラクトと、どちらが信用できるでしょうか？ オラクルは、後者を選ぶ場合に必ず必要になる技術です。</p><h1>Khaos の必要性</h1><p>オラクルの一般的な実装では、スマートコントラクトからイベントを emit して、そのイベントをオラクルプロトコルを構成するサーバーが検知し、最後にコールバック関数を呼び出す、という手法が採られます。emit するイベントのペイロードのなかにスマートコントラクトが要求している情報（例えば、"東京" の "気温" など）を付加することで、オラクルプロトコルはスマートコントラクトが何を欲しているのかを知ります。</p><p>Khaos はオラクルリクエストのためのペイロードを秘匿化することのできるオラクルです。オラクルしたい情報が何らかのシークレットトークンに基づいて取得する必要がある場合、パブリックなペイロードにシークレットトークンをそのまま含めることはできないので、シークレットトークンなどを公開可能な形式に換え安全にする必要があります。</p><p>Khaos を使うと、あなたのシークレットトークンを秘匿化したままで、パブリックブロックチェーン上でオラクルすることができます。</p><h1>Khaos を使う</h1><p>あなたの Dapps でも Khaos を使うことができます。フロントエンドのための SDK, オラクル関数を実装するための Starter Kit を使うことで、すぐに開発を始めることができます。</p><p><em>Khaos で使用可能なスマートコントラクトは現在、Dev Protocol のコアを構成するスマートコントラクトまたは Market, Policy コントラクトに限定されています。将来的にすべてのスマートコントラクトで使用可能になる予定です。</em></p><h2 id="heading-khaos">Khaos のオラクルフロー<a href="#heading-khaos" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>Khaos の開発を始める前に、そのオラクルフローを理解しておくのはいいスタートです。Khaos は Khaos Core, Khaos Functions, Khaos Registry などの複数の要素により成り立ちますが、Dapps 開発者にとって重要なのは以下のフローです。</p><ol><li>Khaos の Sign API(RESTful API) をコールして、秘匿化対象のデータを公開可能に変換した Public Signature を取得します。</li><li>スマートコントラクトからイベントを emit する。このとき、イベントペイロードに Public Signature を含めることで、あなたが定義したオラクル関数は秘匿情報を取り扱うことができます。</li><li>Khaos はあなたが定義したコールバック関数をコールして、フローを閉じます。</li></ol><p>Khaos は多くのインターフェイスをユーザーに委ねることでオラクルに高い自由度を与えています。その代わりユーザーは多くのインターフェイスを自ら実装する必要がありますが、 Khaos Starter Kit を使うことですぐに開発を始めることができます。</p><h2 id="heading-public-signature">Public Signature<a href="#heading-public-signature" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>Khaos を扱ううえで重要なキーワードのひとつに Public Signature があります。</p><p>Public Signature とは Json Web Tokens によって暗号化された文字列ですが、暗号化に使われる情報はすべて公開可能な情報であり、誰でも生成、復号化できます。つまり Public Signature には秘密情報が一切含まれておらず、公開可能です。Khaos ではこの Public Signature をキーとして秘密情報を保存し、Khaos インスタンスの内部でのみ利用します。</p><p>Public Signature は以下のような JSON 文字列を送信者の Ethereum アカウントアドレスによって暗号化したものです。</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"i"</span><span class="token operator">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span><br>  <span class="token property">"m"</span><span class="token operator">:</span> <span class="token string">"..."</span><br><span class="token punctuation">}</span></code></pre><p>実装とテストは Khaos Core で確認できます。<br><a href="https://github.com/dev-protocol/khaos-core/tree/main/src/sign/publicSignature" target="_blank" rel="noopener">khaos-core/src/sign/publicSignature at main · dev-protocol/khaos-core (github.com)</a></p><h2 id="heading-khaos-starter-kit">Khaos Starter Kit<a href="#heading-khaos-starter-kit" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p><a href="https://github.com/dev-protocol/khaos-starter-kit" target="_blank" rel="noopener">dev-protocol/khaos-starter-kit: 🌌Start developing Khaos Functions now (github.com)</a></p><p>ユーザーが定義すべきインターフェイスのテンプレートを提供しています。</p><p>このリポジトリをフォークしたらクローンして、あなたのローカル環境で開発を始めましょう。Khaos Starter Kit は yarn でパッケージマネジメントしているので、事前に <a href="https://classic.yarnpkg.com/en/docs/install/" target="_blank" rel="noopener">yarn をインストールしておく</a>必要もあります。</p><pre class="language-text"><code class="language-text">$ git clone git@github.com:YOUR/khaos-starter-kit.git<br>$ cd khaos-starter-kit<br>$ yarn</code></pre><p>src ディレクトリにはあなたが定義する必要のあるインターフェイスのテンプレート、そしてテストが TypeScript で書いてあります。</p><p>Khaos Starter Kit では、ESLint プラグイン <a href="https://www.npmjs.com/package/eslint-plugin-functional" target="_blank" rel="noopener">eslint-plugin-functional</a> をセキュリティのために推奨しています。あなたはそれを自由に変更できますが、なるべく変更せずに使うことをお勧めします。</p><h3 id="heading-abi.ts">abi.ts<a href="#heading-abi.ts" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p>あなたのスマートコントラクトの ABI を <a href="https://docs.ethers.io/v5/api/utils/abi/formats/#abi-formats--human-readable-abi" target="_blank" rel="noopener">Human-Readable ABI Format</a> で記述した <code>array</code> を定義し、<code>abi</code> と命名してエクスポートします。</p><p>例えば <code>Query</code> というイベント、<code>callback</code> というコールバック関数を持つスマートコントラクトであれば以下のように書きます。Khaos が使用するのはイベントとコールバック関数だけなので、そのスマートコントラクトに他のインターフェイスがあってもすべてをここに定義する必要はありません。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>Abi<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-core'</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> abi<span class="token operator">:</span> Abi <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token string">'event Query(string calldata fooId, string calldata publicSignature, address account, bytes32 queryId)'</span><span class="token punctuation">,</span><br>  <span class="token string">'function callback(bytes32 queryId, bool result) external;'</span><br><span class="token punctuation">]</span></code></pre><h3 id="heading-addresses.ts">addresses.ts<a href="#heading-addresses.ts" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p>オラクルリクエストを emit するスマートコントラクトのアドレスを <code>Promise&lt;string | undefined&gt;</code> で返す関数を定義し、<code>addresses</code> でエクスポートします。この関数の返却値はコールバック関数のアドレスとしても使用されます。</p><p>関数は引数として以下のようなオブジェクトを受け取ります。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token keyword">readonly</span> network<span class="token operator">:</span> <span class="token string">'mainnet'</span> <span class="token operator">|</span> <span class="token string">'ropsten'</span><br><span class="token punctuation">}</span></code></pre><p>Ethereum のメインネットまたは Ropsten テストネットによってアドレスを切り分けることができます。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>FunctionAddresses<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-core'</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> addresses<span class="token operator">:</span> <span class="token function-variable function">FunctionAddresses</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>network<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><br>  network <span class="token operator">===</span> <span class="token string">'mainnet'</span><br>    <span class="token operator">?</span> <span class="token string">'0x1510EA12a30E5c40b406660871b335feA32f29A'</span><br>    <span class="token operator">:</span> <span class="token string">'0x609Fe85Dbb9487d55B5eF50451e20ba2Edc8F4B7'</span></code></pre><h3 id="heading-authorize.ts">authorize.ts<a href="#heading-authorize.ts" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p>Khaos の Sign API がコールされたときに、正規の署名リクエストかどうかを判定して <code>Promise&lt;boolean | undefined&gt;</code> で返す関数を定義し、<code>authorize</code> でエクスポートします。</p><p>authorize の結果が <code>true</code> の場合にのみ Public Signature が生成され、Khaos サーバーに暗号化された秘匿情報が保存されます。</p><p>関数は引数として以下のようなオブジェクトを受け取ります。<code>message</code> は verify の対象となる文字列で、Twitter ID や GitHub リポジトリ名などが該当します。<code>secret</code> には秘匿情報となる文字列です。<br><code>request</code> は @azure/functions の <code>HttpRequest</code> 型なので、Sign API がコールされたときの様々なコンテキストを利用できます。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token keyword">readonly</span> message<span class="token operator">:</span> <span class="token builtin">string</span><br>  <span class="token keyword">readonly</span> secret<span class="token operator">:</span> <span class="token builtin">string</span><br>  <span class="token keyword">readonly</span> request<span class="token operator">:</span> HttpRequest<br><span class="token punctuation">}</span></code></pre><p>Khaos Starter Kit には HTTP ライブラリとして bent がインストールされているので、外部の API をコールして、<code>message</code> が正規のものかどうか判断することができます。また、関数型プログラミングライブラリとして ramda もインストールされているのでケースバイケースで利用してください。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> bent <span class="token keyword">from</span> <span class="token string">'bent'</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>always<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ramda'</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>FunctionAuthorizer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-core'</span><br><br><span class="token keyword">const</span> fetcher <span class="token operator">=</span> <span class="token function">bent</span><span class="token punctuation">(</span><span class="token string">'https://api.foo.bar'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">)</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> authorize<span class="token operator">:</span> <span class="token function-variable function">FunctionAuthorizer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  message<span class="token operator">:</span> user_id<span class="token punctuation">,</span><br>  secret<span class="token punctuation">,</span><br>  request<br><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> authorization <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>headers<span class="token punctuation">}</span> <span class="token operator">=</span> request<br>  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token generic-function"><span class="token function">fetcher</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span>verified<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><br>    <span class="token string">'/verify'</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      user_id<br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      Authorization<span class="token operator">:</span> authorization<span class="token punctuation">,</span><br>      <span class="token string-property property">'User-Agent'</span><span class="token operator">:</span> headers<span class="token punctuation">[</span><span class="token string">'User-Agent'</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token function">always</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> results<span class="token operator">?.</span>verified<br><span class="token punctuation">}</span></code></pre><h3 id="heading-event.ts">event.ts<a href="#heading-event.ts" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p>スマートコントラクトが emit するイベント名を <code>Promice&lt;string | undefined&gt;</code> で返す関数を定義し、<code>event</code> でエクスポートします。</p><p>関数は引数として以下のようなオブジェクトを受け取ります。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token keyword">readonly</span> network<span class="token operator">:</span> <span class="token string">'mainnet'</span> <span class="token operator">|</span> <span class="token string">'ropsten'</span><br><span class="token punctuation">}</span></code></pre><p>Ethereum のメインネットまたは Ropsten テストネットによってイベント名を切り分けることができますが、多くの場合は同じイベント名を使用するはずです。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>FunctionEvent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-core'</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>always<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ramda'</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> event<span class="token operator">:</span> FunctionEvent <span class="token operator">=</span> <span class="token function">always</span><span class="token punctuation">(</span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Query'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="heading-oraclize.ts">oraclize.ts<a href="#heading-oraclize.ts" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p>スマートコントラクトからのオラクルリクエストによってコールされる関数を定義します。この関数はとても重要なパートを担っています。この関数の返却値は後述の <code>pack</code> 関数によって整形された後にスマートコントラクトへのコールバックを介してブロックチェーンに渡されます。 oraclize 関数がコールされるのは、Khaos によってイベントが検出され、Public Signature をキーとして秘匿情報が取得されたあとです。</p><p>関数は引数として以下のようなオブジェクトを受け取ります。<code>signatureOptions</code> は、Public Signature を復号化したデータです。また、<code>signatureOptions</code> は <code>authorize</code> 関数の結果が <code>true</code> を返した際に生成された Public Signature がイベントペイロードに含まれる場合にのみ定義されます。つまり、未認証の Public Signature が含まれている場合は <code>undefined</code> を返します。 <code>query.publicSignature</code> にはイベントペイロードに含まれる Public Signature、<code>query.transanctionhash</code> にはイベントを emit したトランザクションハッシュ、<code>query.allData</code> にはすべてのイベントペイロードが含まれています。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token keyword">readonly</span> signatureOptions<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token keyword">readonly</span> message<span class="token operator">:</span> <span class="token builtin">string</span><br>    <span class="token keyword">readonly</span> id<span class="token operator">:</span> <span class="token builtin">string</span><br>    <span class="token keyword">readonly</span> address<span class="token operator">:</span> <span class="token builtin">string</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">readonly</span> query<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token keyword">readonly</span> publicSignature<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><br>    <span class="token keyword">readonly</span> allData<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><br>    <span class="token keyword">readonly</span> transactionhash<span class="token operator">:</span> <span class="token builtin">string</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">readonly</span> network<span class="token operator">:</span> <span class="token string">'mainnet'</span> <span class="token operator">|</span> <span class="token string">'ropsten'</span><br><span class="token punctuation">}</span></code></pre><p>関数の返却値は以下のようなオブジェクトで解決される Promise です。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  message<span class="token operator">:</span> <span class="token builtin">string</span><br>  status<span class="token operator">:</span> <span class="token builtin">number</span><br>  statusMessage<span class="token operator">:</span> <span class="token builtin">string</span><br><span class="token punctuation">}</span></code></pre><p>次の例では、Public Signature の署名者とオラクルリクエスト送信者が同一アカウントであることを確認しています。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>FunctionOraclizer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-core'</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> oraclize<span class="token operator">:</span> <span class="token function-variable function">FunctionOraclizer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>signatureOptions<span class="token punctuation">,</span> query<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>queryId<span class="token punctuation">,</span> fooId<span class="token punctuation">,</span> account<span class="token punctuation">}</span> <span class="token operator">=</span> query<span class="token punctuation">.</span>allData<br>  <span class="token keyword">const</span> isSameId <span class="token operator">=</span> fooId <span class="token operator">===</span> signatureOptions<span class="token operator">?.</span>message<br>  <span class="token keyword">const</span> isSameUser <span class="token operator">=</span> account <span class="token operator">===</span> signatureOptions<span class="token operator">?.</span>address<br>  <span class="token keyword">return</span> isSameId <span class="token operator">&amp;&amp;</span> isSameUser<br>    <span class="token operator">?</span> <span class="token punctuation">{</span><br>        message<span class="token operator">:</span> queryId<span class="token punctuation">,</span><br>        status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span><br>        statusMessage<span class="token operator">:</span> <span class="token string">'success'</span><br>      <span class="token punctuation">}</span><br>    <span class="token operator">:</span> <span class="token punctuation">{</span><br>        message<span class="token operator">:</span> queryId<span class="token punctuation">,</span><br>        status<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span><br>        statusMessage<span class="token operator">:</span> <span class="token string">'fail'</span><br>      <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h3 id="heading-pack.ts">pack.ts<a href="#heading-pack.ts" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p>スマートコントラクトのコールバック関数名/引数により解決する Promise を返す関数を定義し、<code>pack</code> でエクスポートします。</p><p>関数は引数として以下のようなオブジェクトを受け取ります。<code>results</code> は oraclize が返す Promise が解決したときの値と同じデータです。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token keyword">readonly</span> results<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token keyword">readonly</span> message<span class="token operator">:</span> <span class="token builtin">string</span><br>    <span class="token keyword">readonly</span> status<span class="token operator">:</span> <span class="token builtin">number</span><br>    <span class="token keyword">readonly</span> statusMessage<span class="token operator">:</span> <span class="token builtin">string</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>次の例では、 <code>callback</code> と名付けられた関数に <code>[results.message, results.status, results.statusMessage]</code> という引数でコールバックするように指定しています。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>FunctionPack<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-core'</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> pack<span class="token operator">:</span> <span class="token function-variable function">FunctionPack</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>results<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'callback'</span><span class="token punctuation">,</span><br>    args<span class="token operator">:</span> <span class="token punctuation">[</span>results<span class="token punctuation">.</span>message<span class="token punctuation">,</span> results<span class="token punctuation">.</span>status<span class="token punctuation">,</span> results<span class="token punctuation">.</span>statusMessage<span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="heading-">テスト<a href="#heading-" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>Khaos Starter Kit はデフォルトで ava でテストを書きます。テスティングフレームワークはあなたのプロジェクトに合わせて自由に変更できます。</p><p>テストは Khaos の利用には必須ではありませんが、仕様保証やメンテナンサビリティのために、なるべく正確なテストケースを用意することを強くお勧めします。</p><h2 id="heading-">デプロイ<a href="#heading-" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>すべてのインターフェイスとテストが完成したら、コードをデプロイします。</p><p>Khaos ではユーザー定義の関数は <code>index.js</code> の 1 ファイルにバンドルし、IPFS にデプロイします。Khaos Starter Kit ではデフォルトで Rollup によりバンドルし、Infura の IPFS ノードにデプロイします。</p><p>あなたが実行すべきコマンドはただこれだけです。</p><pre class="language-text"><code class="language-text">yarn deploy</code></pre><p>ソースコードによっては Rollup の設定を更新する必要があったり、追加のプラグインをインストールする必要がある場合があります。その場合、あなたは <code>rollup.config.js</code> を書き換えたり、追加のプラグインをインストールできます。また、Rollup 以外のバンドラーを利用することもできます。</p><p>デプロイすると以下のような標準出力があるので、<code>IPFS_HASH_FOR_DIRECTORY</code> の値をメモしておいてください。</p><pre class="language-text"><code class="language-text">&gt; {"Name":"index.js","Hash":"IPFS_HASH_FOR_FILE","Size":"554"}<br>&gt; {"Name":"","Hash":"IPFS_HASH_FOR_DIRECTORY","Size":"609"}</code></pre><h2 id="heading-khaos-registry">Khaos Registry<a href="#heading-khaos-registry" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p><a href="https://github.com/dev-protocol/khaos-registry" target="_blank" rel="noopener">dev-protocol/khaos-registry: 🌌Khaos Registry for functions ipfs hash (github.com)</a></p><p>IPFS にデプロイされた関数のアドレスマップを管理しています。</p><p>このリポジトリをフォークして、<code>map/functions.json</code> に先ほどメモした <code>IPFS_HASH_FOR_DIRECTORY</code> の値を追記してください。</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"foo-bar"</span><span class="token punctuation">,</span><br>    <span class="token property">"ipfs"</span><span class="token operator">:</span> <span class="token string">"&lt;IPFS_HASH_FOR_DIRECTORY&gt;"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>フォークリポジトリに変更を push したら、ソースリポジトリに対して Pull Request を作成してください。</p><p>現在は Khaos の利用用途を Dev Protocol 関連コントラクトに限定しているため、IPFS にデプロイされた関数の <code>addresses</code> が Dev Protocol 上のコントラクトであることを検証します。</p><p><em>将来的には、Khaos Registry はスマートコントラクトとして再構成、分散化される予定です。</em></p><h2 id="heading-khaos-kit">Khaos Kit<a href="#heading-khaos-kit" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p><a href="https://github.com/dev-protocol/khaos-kit-js" target="_blank" rel="noopener">dev-protocol/khaos-kit-js: 🌌Khaos Kit for JavaScript (github.com)</a></p><p>Khaos Kit は、JavaScript(TypeScript) から Khaos とインタラクションするための API を提供します。</p><h3 id="heading-sign">sign<a href="#heading-sign" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p><code>sign</code> API は、Khaos の Sign API を呼び出す HTTP リクエストのショートハンドです。</p><p>この関数は 2 つの引数を取ります。最初の引数は Khaos の認証 ID で、Khaos Registry の <code>id</code> プロパティで指定したものと同じ文字列です。2 つ目の引数はネットワーク名として <code>'mainnet'</code> または <code>'ropsten'</code> を取ります。</p><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// createPublicSignature.ts</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>sign<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-kit'</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> createPublicSignature <span class="token operator">=</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token string">'foo-bar'</span><span class="token punctuation">,</span> <span class="token string">'mainnet'</span><span class="token punctuation">)</span></code></pre><p><code>sign</code> は <code>KhaosSignOptions</code> を引数に取る関数を返します。<code>KhaosSignOptions</code> の <code>message</code> は署名に用いたメッセージ、<code>signature</code> は Ethereum ウォレットで作成した署名、<code>secret</code> には秘匿化したい情報を渡します。</p><p>Ethereum ウォレットで署名するには、Web3 や Ethers の API を利用してください。</p><ul><li>Web3: <a href="https://web3js.readthedocs.io/en/v1.2.0/web3-eth-personal.html#sign" target="_blank" rel="noopener">web3.eth.personal — web3.js 1.0.0 documentation (web3js.readthedocs.io)</a></li><li>Ethers: <a href="https://docs.ethers.io/v5/api/signer/#Signer-signMessage" target="_blank" rel="noopener">Signers (ethers.io)</a></li></ul><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>KhaosSignOptions<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-kit'</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>createPublicSignature<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./createPublicSignature'</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">getPublicSignature</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> secret<span class="token punctuation">}</span><span class="token operator">:</span> KhaosSignOptions<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createPublicSignature</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    message<span class="token punctuation">,</span><br>    signature<span class="token punctuation">,</span><br>    secret<br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token comment">// {publicSignature: 'eyJ...', address: '0x...'}</span><br>  <span class="token keyword">return</span> results<span class="token punctuation">.</span>publicSignature<br><span class="token punctuation">}</span></code></pre><h3 id="heading-emulate">emulate<a href="#heading-emulate" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h3><p><code>emulate</code> API は、オラクルリクエストのためのイベントを emit したときの結果を off-chain でエミュレーションします。</p><p>この関数は 2 つの引数を取ります。最初の引数は Khaos の認証 ID で、Khaos Registry の <code>id</code> プロパティで指定したものと同じ文字列です。2 つ目の引数はネットワーク名として <code>'mainnet'</code> または <code>'ropsten'</code> を取ります。</p><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// emulator.ts</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>emulate<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-kit'</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> emulator <span class="token operator">=</span> <span class="token function">emulate</span><span class="token punctuation">(</span><span class="token string">'foo-bar'</span><span class="token punctuation">,</span> <span class="token string">'mainnet'</span><span class="token punctuation">)</span></code></pre><p><code>emulate</code> は <code>KhaosEmulateOptions</code> を引数に取る関数を返します。<code>KhaosEmulateOptions</code> は <a href="https://github.com/ethers-io/ethers.js/blob/6c43e20e7a68f3f5a141c74527ec63d9fe8458be/packages/contracts/src.ts/index.ts#L60" target="_blank" rel="noopener">@ethersproject/contracts の <code>Event</code> </a>と同じ情報をすべてオプショナルにした <code>event</code> オブジェクトを取ります。 <code>Event.args</code> は <code>Array</code> を <code>{readonly [key: string]: any}</code> で <code>extend</code> した型ですが、<code>KhaosEmulateOptions.args</code> は <code>Record&lt;string, string | number | undefined | null&gt;</code> でオーバーライドして単純化されています。</p><p>この関数の戻り値は、Khaos Starter Kit で作成した <code>pack</code> の戻り値に <code>expectedTransaction</code> を追加したデータです。</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>KhaosEmulateOptions<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@devprotocol/khaos-kit'</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>emulator<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./emulator'</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">predictCallbackStatus</span> <span class="token operator">=</span>  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>args<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">:</span> KhaosSignOptions<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> results<span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">emulator</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    args<span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><br>    <span class="token comment">/**<br>     * {<br>     *     data: {<br>     *         name: 'callback',<br>     *         args: ['0x...', 200, 'success'],<br>     *         expectedTransaction: {<br>     *             gasLimit: '122004',<br>     *             success: true<br>     *         }<br>     *     }<br>     * }<br>     */</span><br>    <span class="token keyword">return</span> results<span class="token punctuation">.</span>data<span class="token operator">?.</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></div><div class="inner-wrapper pad-top-500 pad-bottom-500 notification"><p>🌈 この記事はお役に立ちましたか？<br><br>今後より良いコンテンツをお届けしていくために、ぜひご質問やフィードバックなどいただけると幸いです🌱<br>▶ <a href="https://community.devprotocol.xyz/" target="_blank">フォーラムはこちら</a><br><br>- Dev Protocol は全てOSSとして公開しています。ぜひIssueやPRを送ってください📢 時にバウンティがあります。<br>▶ <a href="https://github.com/dev-protocol/protocol" target="_blank">Dev ProtocolのGitHubはこちら</a><br><br>- Dev Protocol の改善提案(DIP)プロセスも公開されています。ぜひコメントをお待ちしています🌟<br>▶ <a href="https://github.com/dev-protocol/DIPs/issues" target="_blank">DIPはこちら</a></p></div><footer class="[ post__footer ] [ pad-top-500 pad-bottom-500 ]"><div class="inner-wrapper"><div class="[ nav tags ] [ box-flex align-center ]"><h2 class="font-base text-600 weight-mid" id="heading-tags">Tags<a href="#heading-tags" class="heading-permalink"><span class="visually-hidden"> permalink</span><svg fill="currentColor" aria-hidden="true" focusable="false" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><ul class="[ nav__list ] [ box-flex align-center pad-left-400 ] [ p-category ]"><li class="tag__item"><a href="/ja/tags/Khaos">Khaos</a></li><li class="tag__item"><a href="/ja/tags/オラクル">オラクル</a></li></ul></div></div></footer></article></main><footer role="contentinfo" class="[ site-foot ] [ font-base text-base weight-bold ] [ pad-top-maxover pad-bottom-maxover ]"><div class="wrapper"><div class="[ site-foot__inner-top ] [ md:box-flex space-before align-start ]"><lang-switch></lang-switch></div><div class="[ site-foot__inner ] [ md:box-flex space-between align-start ]"><div class="[ site-foot__inner__item ]"><a href="https://devprotocol.xyz/" target="_blank"><img class="brand" src="/images/dev-protocol-logo-footer01.svg" alt="Dev Protocol"></a></div><div class="[ site-foot__inner__item ]"><div class="[ site-foot__inner__link-item ]"><a target="_blank" class="" href="https://discord.gg/VwJp4KM">Discord</a></div><div class="[ site-foot__inner__link-item ]"><a target="_blank" class="" href="https://twitter.com/devprtcl">Twitter</a></div><div class="[ site-foot__inner__link-item ]"><a target="_blank" class="" href="https://docs.devprotocol.xyz/">Docs</a></div><div class="[ site-foot__inner__link-item ]"><a target="_blank" class="" href="https://github.com/dev-protocol">GitHub</a></div><div class="[ site-foot__inner__link-item ]"><a target="_blank" class="" href="https://medium.com/devprtcl">Medium</a></div></div></div></div></footer><script type="module" src="/js/components/lang-switch.js" async="" defer="defer"></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script>window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#ffffff"
        },
        "button": {
          "background": "#000000",
          "text": "#ffffff"
        }
      },
      "showLink": false,
      "position": "bottom-right"
    });</script></body></html>